<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   <!-- Include Bootstrap -->
   <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


  <title>Timer entries</title>

  <!-- Include charts.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>

  .table-style{
    margin-top: 50px;
    margin-left: 100px;
    margin-right: 100px;
  }
  </style>
  </head>

  {% extends "base.html" %}

  {% block content %}
  <body style="background-color:#EDEAE5">
    <div>
      <h1 style="text-align:center; margin-bottom: 50px; margin-top: 50px;">Summary of your current projects</h1>
    </div>

      <!--
      <div style="position:static; top:60px; left:10px; width:500px; height:500px;">
      <canvas id="myChart1" width="50" height="50"></canvas>
      <canvas id="myChart2" width="50" height="50"></canvas>
    </div>-->
    <div class="row" style="margin-bottom: 50px">
      <div class="col-md-6" style="text-align:right">
        <p>Display data by: </p>
      </div>
      <div class="col-md-4">
        <input type="text" list="timeSpans" class="form-control" id="timeSpansList"/>
        <datalist id="timeSpans">
          <option value=allTime>All time</option>
          <option value=thisMonth>This month</option>
        </datalist>
      </div>
      <div class="col-md-2"></div>
    </div>

      <div class="container">
        <div class="row">
          <div class="col">
            <canvas id="myChart1" width="50" height="50"></canvas>
          </div>
          <div class="col">
            <canvas id="myChart2" width="50" height="50"></canvas>
          </div>
        </div>
      </div>

    <div class="table-style">
      <table class="table table-hover">
        <tr>
          <th>Activity</th>
          <th>Duration</th>
          <th>Entry time</th>
          <th>Project</th>
        </tr>
        {% for item in allEntries %}
          <tr>
            <td>{{item.item}}</td>
            <td>{{item.duration}}</td>
            <td>{{item.entryTime}}</td>
            <td>{{item.associatedProject}}</td>
          </tr>
        {% endfor %}

        {% for key, value in json.allProjectsDict %}
          <li>{{hello}}</li>
        {% endfor %}

      </table>
    </div>

<br>
<br>
<br>

  </body>


  <script>

    // data and display for the projects-proportionality pie chart
    const labels1 = [];
    const datapoints1 = [];

    {% for key, value in allProjectsDict.items %}
      var key = "{{key}}";
      var val = "{{value}}";

      if(val > 0){
        labels1.push(key);
        datapoints1.push(val);
      }

    {% endfor %}


    const data1 = {
    labels: labels1,
    datasets: [{
      label: 'Distribution by project',
      backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f", "#2B1C2F", "#CBB89A", "#C23B22", "#F76C6C"],
      data: datapoints1,
    }]
    };

    const config1 = {
    type: 'pie',
    data: data1,
    options: {
      title: {
        display: true,
        text: 'Distribution by project',
      }
    }
    };

    var ctx1 = document.getElementById("myChart1").getContext("2d");

    var myChart1 = new Chart(
        ctx1,
        config1
    );

    // data and display for the task frequency bar chart
    const labels2 = [];
    const datapoints2 = [];

    {% for key, value in mostCommonEntries.items %}
      var key = "{{key}}";
      var val = "{{value}}";
      labels2.push(key);
      datapoints2.push(val);
    {% endfor %}

    console.log(labels2, datapoints2);
    const data2 = {
    labels: labels2,
    datasets: [{
      label: 'Most frequently done tasks',
      backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f", "#2B1C2F", "#CBB89A", "#C23B22", "#F76C6C"],
      data: datapoints2,
    }]
    };

    const config2 = {
    type: 'bar',
    data: data2,
    options: {
      title: {
        display: true,
        text: 'Most frequently tasks',
      }
    }
    };

    var ctx2 = document.getElementById("myChart2").getContext("2d");

    var myChart2 = new Chart(
        ctx2,
        config2
    );

    // script for fetching data from the views through ajax for updating the timespan for which data is displayed
    document.getElementById("timeSpansList").onchange = function(){
      // send ajax request to views from here and update charts
      var variable = document.getElementById("timeSpansList").value

      // make get call to ajax to filter data for the specified timespan
    };


  </script>

  {% endblock %}
</html>
